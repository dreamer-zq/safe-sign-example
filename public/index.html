<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Multi-Signature Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Safe Multi-Signature Manager</h1>
        </header>

        <!-- Configuration and Status Section -->
        <div class="config-status-container">
            <!-- Configuration Section -->
            <section class="config-section">
                <h2>Configuration</h2>
                <div class="config-grid">
                    <div class="config-row">
                        <div class="config-item">
                            <label for="txServiceUrl">Transaction Service URL:</label>
                            <input type="text" id="txServiceUrl" placeholder="http://localhost:8000/api/" value="http://localhost:8000/api/">
                        </div>
                        <div class="config-item">
                            <label for="rpcUrl">Chain RPC URL:</label>
                            <input type="text" id="rpcUrl" placeholder="https://testnet.hsk.xyz" value="https://testnet.hsk.xyz">
                        </div>
                    </div>
                    <div class="config-row">
                        <div class="config-item">
                            <label for="privateKey">Private Key:</label>
                            <input type="password" id="privateKey" placeholder="0x...">
                        </div>
                        <div class="config-item">
                            <label for="safeAddress">Safe Address:</label>
                            <input type="text" id="safeAddress" placeholder="0x...">
                        </div>
                    </div>
                </div>
                <div class="config-actions">
                    <button id="saveConfig" class="btn btn-primary">Save Configuration</button>
                    <button id="loadConfig" class="btn btn-secondary">Load Configuration</button>
                </div>
            </section>

            <!-- Status Section -->
            <section class="status-section">
                <h2>Safe Status</h2>
                <div class="status-container">
                    <div class="status-row">
                        <div class="status-item">
                            <span class="status-label">Safe Address:</span>
                            <span id="currentSafeAddress" class="status-value">Not connected</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Is Deployed:</span>
                            <span id="isDeployed" class="status-value">Unknown</span>
                        </div>
                    </div>
                    <div class="status-row">
                        <div class="status-item">
                            <span class="status-label">Signer Address:</span>
                            <span id="signerAddress" class="status-value">Not connected</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Signer Balance:</span>
                            <span id="signerBalance" class="status-value">0 ETH</span>
                        </div>
                    </div>
                    <div class="status-row">
                        <div class="status-item status-item-full">
                            <span class="status-label">Connection Status:</span>
                            <span id="connectionStatus" class="status-value">Disconnected</span>
                        </div>
                    </div>
                </div>
                <div class="status-actions">
                    <button id="createSafe" class="btn btn-success">Create Safe</button>
                    <button id="connectSafe" class="btn btn-primary">Connect Safe</button>
                </div>
            </section>
        </div>

        <!-- Pending Transactions Section -->
        <section class="transactions-section" id="transactionsSection">
            <div class="section-header">
                <h2>Pending Transactions</h2>
                <div class="header-controls">
                    <div id="autoRefreshCountdown" class="auto-refresh-countdown">
                        <span class="countdown-text">Next refresh in: </span>
                        <span id="countdownTimer" class="countdown-timer">10s</span>
                    </div>
                    <button id="proposeBtn" class="propose-btn">Propose</button>
                </div>
            </div>
            <div id="transactionsContainer" class="transactions-container scrollable-container">
                <div class="no-transactions">
                    <p>No pending transactions found</p>
                </div>
            </div>
            <!-- Transactions Loading Overlay -->
            <div id="transactionsLoadingOverlay" class="transactions-loading-overlay hidden">
                <div class="transactions-loading-spinner"></div>
                <div class="transactions-loading-text">Processing transaction...</div>
            </div>
        </section>


    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Transaction Details Modal -->
    <div id="transactionModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Transaction Details</h3>
                <button class="modal-close" onclick="safeManager.closeTransactionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="transactionDetailsContent">
                    <!-- Transaction details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Propose Transaction Modal -->
    <div id="proposeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Propose New Transaction</h3>
                <button class="modal-close" onclick="safeManager.closeProposeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="proposeForm" class="propose-form">
                    <div class="form-group">
                        <label for="proposeTargetAddress">Target Contract Address:</label>
                        <input type="text" id="proposeTargetAddress" placeholder="0x..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="proposeContractAbi">Contract ABI (JSON format):</label>
                        <textarea id="proposeContractAbi" rows="4" placeholder='["function transfer(address _to, uint256 _value) returns (bool)"]' oninput="safeManager.parseContractAbi()" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="proposeMethodName">Method Name:</label>
                        <select id="proposeMethodName" onchange="safeManager.generateMethodParameters()" required>
                            <option value="">Select a method...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                            <label for="proposeMethodParams">Method Parameters (JSON format):</label>
                            <textarea id="proposeMethodParams" rows="2" placeholder='["0x4739680F1A3F6aE7E0036979E6A81D76Fd2EE6e3", 1000000]' required></textarea>
                        </div>
                    
                    <div class="form-group">
                        <label for="proposeValue">Value (ETH):</label>
                        <input type="text" id="proposeValue" placeholder="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="proposeOperation">Operation:</label>
                        <select id="proposeOperation">
                            <option value="0">Call (0)</option>
                            <option value="1">DelegateCall (1)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="proposeSafeTxGas">Safe Transaction Gas:</label>
                        <input type="text" id="proposeSafeTxGas" placeholder="100000" value="100000">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Submit Transaction</button>
                        <button type="button" class="btn" onclick="safeManager.closeProposeModal()">Cancel</button>
                    </div>
                </form>
            </div>
            <!-- Propose Modal Loading Overlay -->
            <div id="proposeLoadingOverlay" class="modal-loading-overlay hidden">
                <div class="modal-loading-spinner"></div>
                <div class="modal-loading-text">Proposing transaction...</div>
            </div>
        </div>
    </div>

    <!-- Error Display -->
    <div id="errorDisplay" class="error-display hidden">
        <div class="error-content">
            <span class="error-icon">⚠️</span>
            <span id="errorMessage" class="error-message"></span>
            <button class="error-close" onclick="hideError()">&times;</button>
        </div>
    </div>

    <!-- Create Safe Modal -->
    <div id="createSafeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Safe</h3>
                <button class="modal-close" onclick="safeManager.closeCreateSafeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createSafeForm" class="propose-form">
                    <div class="form-group">
                        <label for="createSafeOwners">Owner Addresses (one per line):</label>
                        <textarea id="createSafeOwners" rows="4" placeholder="0x742d35Cc6634C0532925a3b8D4C9db96c4b4d8b&#10;0x123...&#10;0x456..." required></textarea>
                        <small class="form-help">Enter each owner address on a new line</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="createSafeThreshold">Threshold:</label>
                        <input type="number" id="createSafeThreshold" min="1" placeholder="2" required>
                        <small class="form-help">Number of signatures required for transactions</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="createSafeSaltNonce">Salt Nonce:</label>
                        <input type="text" id="createSafeSaltNonce" placeholder="123456789" required>
                        <small class="form-help">Unique number for deterministic address generation</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="safeManager.closeCreateSafeModal()">Cancel</button>
                        <button type="submit" class="btn btn-success">Create Safe</button>
                    </div>
                </form>
            </div>
            <!-- Create Safe Modal Loading Overlay -->
            <div id="createSafeLoadingOverlay" class="modal-loading-overlay hidden">
                <div class="modal-loading-spinner"></div>
                <div class="modal-loading-text">Creating Safe...</div>
            </div>
        </div>
    </div>

    <!-- Success Display -->
    <div id="successDisplay" class="error-display success hidden">
        <div class="error-content">
            <span class="error-icon">✅</span>
            <span id="successMessage" class="error-message"></span>
            <button class="error-close" onclick="hideSuccess()">&times;</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</body>
</html>